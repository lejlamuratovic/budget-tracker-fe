import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';

import { getAllExpenses, createExpense, updateExpense, deleteExpense, getCategoryChartData, getDailyExpenseOverview } from '../api';
import { CategoryChartData, DailyExpense, Expense, ExpenseFilterParams } from '../types';


export const useExpenses = (params: ExpenseFilterParams) => {
    return useQuery<Expense[]>({
        queryKey: ['expenses', params],
        queryFn: () => getAllExpenses(params),
    });
};

export const useCreateExpense = () => {
    const queryClient = useQueryClient();

    return useMutation<Expense, Error, Partial<Expense>>({
        mutationFn: createExpense,
        onSuccess: () => {
            // Invalidate the 'expenses' query to refresh the expense list
            queryClient.invalidateQueries({ queryKey: ['expenses'] });
        },
    });
};

export const useUpdateExpense = () => {
    const queryClient = useQueryClient();

    return useMutation<Expense, Error, { id: number; expense: Partial<Expense> }>({
        mutationFn: updateExpense,
        onSuccess: () => {
            // Invalidate the 'expenses' query to refresh the expense list
            queryClient.invalidateQueries({ queryKey: ['expenses'] });
        },
    });
};

export const useDeleteExpense = () => {
    const queryClient = useQueryClient();
    
    return useMutation<void, Error, number>({
        mutationFn: deleteExpense,
        onSuccess: () => {
            // Invalidate the 'expenses' query to refresh the expense list
            queryClient.invalidateQueries({ queryKey: ['expenses'] });
        },
    });
};

export const useCategoryChartData = (filters: { userId: number; startDate?: Date | null; endDate?: Date | null }) => {
    return useQuery<CategoryChartData[]>({
        queryKey: ['categoryChartData', filters],
        queryFn: () => getCategoryChartData(filters),
    });
};


export const useDailyExpenses = (userId: number, startDate?: string | null, endDate?: string | null) => {
    return useQuery<DailyExpense[]>({
        queryKey: ['dailyExpenses', { userId, startDate, endDate }],
        queryFn: () => getDailyExpenseOverview(userId, startDate, endDate),
    });
};
